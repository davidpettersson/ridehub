{% extends 'web/_base_bootstrap.html' %}
{% block title %}{{ month_name }} {{ year }}{% endblock %}
{% block content %}
    <div class="mb-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div class="d-flex align-items-center gap-3">
                <div class="d-flex align-items-center gap-1">
                    <a href="{% url 'calendar_month' prev_year prev_month %}" class="btn btn-light rounded-circle d-flex align-items-center justify-content-center calendar-nav-btn" style="width: 40px; height: 40px; border: none;" title="Previous month">
                        <i class="bi bi-chevron-left"></i>
                    </a>
                    <a href="{% url 'calendar_month' next_year next_month %}" class="btn btn-light rounded-circle d-flex align-items-center justify-content-center calendar-nav-btn" style="width: 40px; height: 40px; border: none;" title="Next month">
                        <i class="bi bi-chevron-right"></i>
                    </a>
                </div>
                <h1 class="fs-2 fw-bold mb-0 d-flex align-items-center gap-2">
                    <span>{{ month_name }} {{ year }}</span>
                    {% if year != today.year or month != today.month %}
                    <a href="{% url 'calendar_month' today.year today.month %}" class="btn btn-light rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px; border: none;" title="Go to current month" aria-label="Go to current month">
                        <i class="bi bi-arrow-counterclockwise"></i>
                    </a>
                    {% endif %}
                </h1>
            </div>
            <div class="d-flex justify-content-end">
                <a href="{% url 'upcoming' %}" class="btn btn-light rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px; border: none;" title="Switch to list view" aria-label="Switch to list view">
                    <i class="bi bi-list-ul"></i>
                </a>
            </div>
        </div>
        
        <div class="calendar-grid">
            <div class="card">
                <div class="card-body p-0">
                    <table class="table table-bordered mb-0" style="table-layout: fixed;">
                        <thead class="table-light">
                            <tr>
                                <th class="text-center py-2" style="width: 14.28%;">Sun</th>
                                <th class="text-center py-2" style="width: 14.28%;">Mon</th>
                                <th class="text-center py-2" style="width: 14.28%;">Tue</th>
                                <th class="text-center py-2" style="width: 14.28%;">Wed</th>
                                <th class="text-center py-2" style="width: 14.28%;">Thu</th>
                                <th class="text-center py-2" style="width: 14.28%;">Fri</th>
                                <th class="text-center py-2" style="width: 14.28%;">Sat</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for week in month_days %}
                            <tr>
                                {% for day in week %}
                                <td class="p-0 calendar-day" style="min-height: 120px; vertical-align: top;">
                                    {% if day != 0 %}
                                        <div class="p-2" style="min-height: 96px;">
                                            <div class="d-flex justify-content-between align-items-start mb-1">
                                                <span class="fw-medium{% if day == today.day and month == today.month and year == today.year %} text-primary{% endif %}">{{ day }}</span>
                                            </div>
                                            {% for event_date, events in events_by_date.items %}
                                                {% if event_date.day == day %}
                                                    {% for event in events %}
                                                    <div class="mb-1">
                                                        <a href="{% url 'event_detail' event.id %}" class="text-decoration-none">
                                                            {% if event.starts_at.date < today %}
                                                            <div class="p-1 bg-secondary bg-opacity-10 border border-secondary border-opacity-25 rounded text-secondary" title="{{ event.name }} - {{ event.starts_at|date:'g:i A'|lower|cut:'.m.' }}{% if event.ends_at %} - {{ event.ends_at|date:'g:i A'|lower|cut:'.m.' }}{% endif %}">
                                                                <div class="fw-medium text-truncate" style="font-size: 0.65rem;">{{ event.starts_at|date:"g:i A"|lower|cut:".m." }}{% if event.ends_at %} - {{ event.ends_at|date:"g:i A"|lower|cut:".m." }}{% endif %}</div>
                                                                <div class="text-truncate" style="font-size: 0.75rem;">{{ event.name }}</div>
                                                            </div>
                                                            {% else %}
                                                            <div class="p-1 bg-primary bg-opacity-10 border border-primary border-opacity-25 rounded text-primary" title="{{ event.name }} - {{ event.starts_at|date:'g:i A'|lower|cut:'.m.' }}{% if event.ends_at %} - {{ event.ends_at|date:'g:i A'|lower|cut:'.m.' }}{% endif %}">
                                                                <div class="fw-medium text-truncate" style="font-size: 0.65rem;">{{ event.starts_at|date:"g:i A"|lower|cut:".m." }}{% if event.ends_at %} - {{ event.ends_at|date:"g:i A"|lower|cut:".m." }}{% endif %}</div>
                                                                <div class="text-truncate" style="font-size: 0.75rem;">{{ event.name }}</div>
                                                            </div>
                                                            {% endif %}
                                                        </a>
                                                    </div>
                                                    {% endfor %}
                                                {% endif %}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </td>
                                {% endfor %}
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div class="mt-4 text-center">
            <p class="text-muted small mb-0">
                Subscribe to this calendar: 
                <a href="webcal://{{ request.get_host }}{% url 'event_feed' %}" 
                   class="text-decoration-none" 
                   title="Add to Apple Calendar on iPhone/iPad/Mac">iPhone/iPad</a>, 
                <a href="https://calendar.google.com/calendar/render?cid={{ request.build_absolute_uri }}{% url 'event_feed' %}" 
                   target="_blank" 
                   class="text-decoration-none" 
                   title="Add to Google Calendar (Android/Web)">Google Calendar</a>, 
                <a href="https://outlook.live.com/calendar/0/addfromweb?url={{ request.build_absolute_uri }}{% url 'event_feed' %}" 
                   target="_blank" 
                   class="text-decoration-none" 
                   title="Add to Microsoft 365 / Outlook Online">Outlook</a>, or 
                <a href="{% url 'event_feed' %}" 
                   class="text-decoration-none" 
                   title="Download ICS file for other calendar apps">other apps</a>
            </p>
        </div>
    </div>
{% endblock %}
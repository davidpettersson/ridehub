{% extends 'web/_base.html' %}
{% block title %}Riders for {{ event.name }}{% endblock %}
{% block content %}
<div class="container py-4">
    <div class="mb-4">
        <a href="{% url 'profile' %}" class="btn btn-link text-decoration-none">
            <i class="bi bi-arrow-left me-2"></i> Back to my profile
        </a>
    </div>

    <div>
        <h1 class="h3 mb-3">
            Riders for {% if event.cancelled %}<span class="text-decoration-line-through">{{ event.name }}</span> (cancelled){% else %}{{ event.name }}{% endif %}
        </h1>
    </div>
    
    <div class="card p-3 mb-4">
        <div class="row align-items-center">
            <div class="col-md">
                <div class="d-flex flex-wrap small text-muted">
                    <div class="me-3 mb-2 mb-md-0"><i class="bi bi-calendar-event me-2"></i>{{ event.starts_at|date:"l, F j, Y" }}</div>
                    <div class="me-3 mb-2 mb-md-0"><i class="bi bi-clock me-2"></i>{{ event.starts_at|date:"g:i A" }}</div>
                    {% if event.location %}
                    <div class="me-3 mb-2 mb-md-0">
                        <i class="bi bi-geo-alt me-2"></i>
                        {% if event.location_url %}
                        <a href="{{ event.location_url }}" class="text-primary text-decoration-none" target="_blank" rel="noopener noreferrer">
                            {{ event.location }}
                            <i class="bi bi-box-arrow-up-right ms-1 small"></i>
                        </a>
                        {% else %}
                        {{ event.location }}
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    {% if all_riders %}
        <!-- Mobile view (card-based layout) -->
        <div class="d-md-none">
            {% for rider_reg in all_riders %}
                <div class="card mb-3">
                    <div class="card-body p-3">
                        <h4 class="card-title h5">{{ rider_reg.name }}</h4>
                        <div class="small mt-2">
                            <p class="mb-1"><strong>Ride:</strong> <span class="text-muted">{{ rider_reg.ride.name|default:"N/A" }}</span></p>
                            <p class="mb-1"><strong>Speed Group:</strong> <span class="text-muted">{{ rider_reg.speed_range_preference.range|default:"N/A" }}</span></p>
                            <p class="mb-1"><strong>Email:</strong> <span class="text-muted">{{ rider_reg.email }}</span></p>
                            <p class="mb-1"><strong>Ride Leader:</strong> <span class="text-muted">{% if rider_reg.ride_leader_preference == 'y' %}Yes{% else %}No{% endif %}</span></p>
                            
                            <div class="mt-2 pt-2 border-top border-danger-subtle">
                                <p class="mb-1"><strong>Emergency:</strong> <span class="text-muted">{{ rider_reg.emergency_contact_name }}</span></p>
                                <p class="mb-0"><strong>Phone:</strong> 
                                    <a href="tel:{{ rider_reg.emergency_contact_phone }}" class="text-primary text-decoration-none">
                                        {{ rider_reg.emergency_contact_phone }}
                                    </a>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
        
        <!-- Desktop view (table-based layout) -->
        <div class="d-none d-md-block card">
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-striped table-hover mb-0 small">
                        <thead class="table-light">
                            <tr>
                                <th scope="col" class="px-3 py-2">Name</th>
                                <th scope="col" class="px-3 py-2">Ride</th>
                                <th scope="col" class="px-3 py-2">Speed Group</th>
                                <th scope="col" class="px-3 py-2">Email</th>
                                <th scope="col" class="px-3 py-2">Ride Leader</th>
                                <th scope="col" class="px-3 py-2">Emergency Contact</th>
                                <th scope="col" class="px-3 py-2">Emergency Phone</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for rider_reg in all_riders %}
                                <tr>
                                    <td class="px-3 py-2">{{ rider_reg.name }}</td>
                                    <td class="px-3 py-2 text-muted">{{ rider_reg.ride.name|default:"N/A" }}</td>
                                    <td class="px-3 py-2 text-muted">{{ rider_reg.speed_range_preference.range|default:"N/A" }}</td>
                                    <td class="px-3 py-2 text-muted">{{ rider_reg.email }}</td>
                                    <td class="px-3 py-2 text-muted">
                                        {% if rider_reg.ride_leader_preference == 'y' %}Yes{% else %}No{% endif %}
                                    </td>
                                    <td class="px-3 py-2 text-muted">{{ rider_reg.emergency_contact_name }}</td>
                                    <td class="px-3 py-2 text-muted">
                                        <a href="tel:{{ rider_reg.emergency_contact_phone }}" class="text-primary text-decoration-none">
                                            {{ rider_reg.emergency_contact_phone }}
                                        </a>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    {% else %}
        <div class="card text-center p-4">
            <p class="text-muted mb-0">No riders found for this event.</p>
        </div>
    {% endif %}
</div>
{% endblock %} 
{% extends 'web/_base_bootstrap.html' %}
{% block title %}Riders for {{ event.name }}{% endblock %}
{% block content %}
<div class="mb-5">
    <div class="mb-4">
        <a href="{% url 'profile' %}" class="d-inline-flex align-items-center text-muted small">
            <i class="bi bi-arrow-left me-2"></i> Back to my profile
        </a>
    </div>

    <div>
        <h1 class="fs-2 fw-bold">
            Riders for {% if event.cancelled %}<span class="text-decoration-line-through">{{ event.name }}</span> (cancelled){% else %}{{ event.name }}{% endif %}
        </h1>
    </div>
    
    <div class="card shadow-sm p-4 mb-4">
        <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-md-between">
            <div class="d-flex flex-wrap gap-3 small">
                <div class="d-inline-flex align-items-center text-muted">
                    <i class="bi bi-calendar-event me-2"></i>
                    <span>{{ event.starts_at|date:"l, F j, Y" }}</span>
                </div>
                
                <div class="d-inline-flex align-items-center text-muted">
                    <i class="bi bi-clock me-2"></i>
                    <span>{{ event.starts_at|date:"g:i A" }}</span>
                </div>
                
                {% if event.location %}
                <div class="d-inline-flex align-items-center text-muted">
                    <i class="bi bi-geo-alt me-2"></i>
                    {% if event.location_url %}
                    <a href="{{ event.location_url }}" 
                       class="text-primary d-flex align-items-center"
                       target="_blank" rel="noopener noreferrer">
                        {{ event.location }}
                        <i class="bi bi-box-arrow-up-right ms-1 small"></i>
                    </a>
                    {% else %}
                    <span>{{ event.location }}</span>
                    {% endif %}
                </div>
                {% endif %}
            </div>
            
            <!-- Global emergency button -->
        </div>
    </div>
    
    {% if all_riders %}
        <!-- Mobile view (card-based layout) -->
        <div class="d-md-none">
            {% for rider_reg in all_riders %}
                <div class="card mb-3 p-4">
                    <div class="d-flex flex-column align-items-start mb-2">
                        <div class="d-flex align-items-center">
                            <h4 class="fw-medium fs-5 mb-0">{{ rider_reg.name }}</h4>
                            {% if rider_reg.ride_leader_preference == 'y' %}
                                <span class="badge text-bg-primary ms-2">Ride leader</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="small">
                        <div class="row mb-1">
                            <div class="col-5 fw-medium">Ride:</div>
                            <div class="col-7 text-muted">{{ rider_reg.ride.name|default:"N/A" }}</div>
                        </div>
                        <div class="row mb-1">
                            <div class="col-5 fw-medium">Speed group:</div>
                            <div class="col-7 text-muted">{{ rider_reg.speed_range_preference.range|default:"N/A" }}</div>
                        </div>
                        
                        <div class="mt-3 border-top border-danger-subtle pt-2 w-100">
                            <div class="row mb-1">
                                <div class="col-5 fw-medium">Email:</div>
                                <div class="col-7 text-muted">
                                    <a href="mailto:{{ rider_reg.email }}" class="text-primary">
                                        {{ rider_reg.email }}
                                    </a>
                                </div>
                            </div>
                            <div class="row mb-1">
                                <div class="col-5 fw-medium">Emergency:</div>
                                <div class="col-7 text-muted">{{ rider_reg.emergency_contact_name }}</div>
                            </div>
                            <div class="row mb-1">
                                <div class="col-5 fw-medium">Phone:</div>
                                <div class="col-7 text-muted">
                                    <a href="tel:{{ rider_reg.emergency_contact_phone }}" class="text-primary">
                                        {{ rider_reg.emergency_contact_phone }}
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
        
        <!-- Desktop view (table-based layout) -->
        <div class="d-none d-md-block card shadow-sm overflow-auto">
            <div class="p-4">
                <table class="table">
                    <thead>
                        <tr>
                            <th scope="col" class="small fw-medium">Name</th>
                            <th scope="col" class="small fw-medium">Ride</th>
                            <th scope="col" class="small fw-medium">Speed group</th>
                            <th scope="col" class="small fw-medium">Ride leader</th>
                            <th scope="col" class="small fw-medium">Email</th>
                            <th scope="col" class="emergency-info small fw-medium">Emergency contact</th>
                            <th scope="col" class="emergency-info small fw-medium">Emergency phone</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for rider_reg in all_riders %}
                            <tr>
                                <td class="small fw-medium">{{ rider_reg.name }}</td>
                                <td class="small text-muted">{{ rider_reg.ride.name|default:"N/A" }}</td>
                                <td class="small text-muted">{{ rider_reg.speed_range_preference.range|default:"N/A" }}</td>
                                <td class="small text-muted">
                                    {% if rider_reg.ride_leader_preference == 'y' %}
                                        <span class="badge text-bg-primary">Yes</span>
                                    {% else %}
                                        <span class="badge text-bg-light">No</span>
                                    {% endif %}
                                </td>
                                <td class="small text-muted">
                                    <a href="mailto:{{ rider_reg.email }}" class="text-primary">
                                        {{ rider_reg.email }}
                                    </a>
                                </td>
                                <td class="emergency-info small text-muted">
                                    {{ rider_reg.emergency_contact_name }}
                                </td>
                                <td class="emergency-info small text-muted">
                                    <a href="tel:{{ rider_reg.emergency_contact_phone }}" class="text-primary">
                                        {{ rider_reg.emergency_contact_phone }}
                                    </a>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    {% else %}
        <div class="py-5 text-center card">
            <p class="text-muted">No riders found for this event.</p>
        </div>
    {% endif %}
</div>

{% endblock %} 
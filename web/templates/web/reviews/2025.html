{% extends 'web/_base_bootstrap.html' %}

{% block title %}Year in review 2025 - RideHub{% endblock %}

{% block content %}
<style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@800;900&family=Lato:wght@400;700&display=swap');

    body {
        font-family: 'Lato', sans-serif;
    }

    .headline-title {
        font-family: 'Inter', sans-serif;
        font-weight: 900;
        font-size: 5.5rem;
        letter-spacing: -0.03em;
        background: linear-gradient(135deg, #0d6efd 0%, #0dcaf0 50%, #20c997 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        line-height: 1;
        margin: 20px 0;
        text-transform: uppercase;
    }

    h1, h2, h3, h4, h5, h6 {
        font-family: 'Inter', sans-serif;
        font-weight: 800;
        letter-spacing: -0.02em;
    }

    @media (max-width: 768px) {
        .headline-title {
            font-size: 2.8rem;
        }
    }
</style>

<div class="container my-5">
    <div class="text-center mb-5">
        <h1 class="headline-title">OUR 2025 RIDING STORY</h1>
        <p class="lead text-muted">A look back at an incredible year of riding together</p>
    </div>

    <section class="mb-5">
        <h2 class="h3 fw-bold mb-4 text-center">Headline numbers</h2>
        <p class="lead text-center m-4">We had another strong year riding together! The Youth Programs numbers are not included here, but adds another 230+ unique riders participating in road, mountain bike, cyclocross and track events.</p>
        <div class="row g-4 mb-3">
        <div class="col-md-6 col-lg-4">
            <div class="card shadow-sm h-100">
                <div class="card-body text-center p-4">
                    <div class="display-3 fw-bold text-primary mb-2">{{ stats.total_events }}</div>
                    <h5 class="text-muted mb-0">Events held</h5>
                    <p class="text-muted small mb-0 mt-2">Excludes Youth events.</p>
                </div>
            </div>
        </div>

        <div class="col-md-6 col-lg-4">
            <div class="card shadow-sm h-100">
                <div class="card-body text-center p-4">
                    <div class="display-3 fw-bold text-success mb-2">{{ stats.total_registrations }}</div>
                    <h5 class="text-muted mb-0">Total registrations</h5>
                    <p class="text-muted small mb-0 mt-2">Excludes Time Trial and Youth registrations.</p>
                </div>
            </div>
        </div>

        <div class="col-md-6 col-lg-4">
            <div class="card shadow-sm h-100">
                <div class="card-body text-center p-4">
                    <div class="display-3 fw-bold text-info mb-2">{{ stats.unique_participants }}</div>
                    <h5 class="text-muted mb-0">Unique riders</h5>
                    <p class="text-muted small mb-0 mt-2">Distinct riders with confirmed registrations. Excludes Time Trial and Youth riders</p>
                </div>
            </div>
        </div>

        <div class="col-md-6 col-lg-6">
            <div class="card shadow-sm h-100">
                <div class="card-body text-center p-4">
                    <div class="display-3 fw-bold text-warning mb-2">{{ stats.total_distance|floatformat:0 }}</div>
                    <h5 class="text-muted mb-0">Total kilometers</h5>
                    <p class="text-muted small mb-0 mt-2">Confirmed registrations Ã— route distance</p>
                </div>
            </div>
        </div>

        <div class="col-md-6 col-lg-6">
            <div class="card shadow-sm h-100">
                <div class="card-body text-center p-4">
                    <div class="display-3 fw-bold text-danger mb-2">{{ stats.total_elevation|floatformat:0 }}</div>
                    <h5 class="text-muted mb-0">Total elevation gain (m)</h5>
                    <p class="text-muted small mb-0 mt-2">Confirmed registrations Ã— route elevation gain</p>
                </div>
            </div>
        </div>
        </div>
    </section>

    <section class="mb-5">
        <h2 class="h3 fw-bold mb-4 text-center">Ride leader recognition</h2>
        <p class="lead text-center mb-4">Our ride leaders, coaches and ride coordinators make every event possible.
                {{ stats.total_ride_leaders }} riders stepped up to lead rides throughout 2025. Our Youth Program engages 50+ coaches.
                Thank you for your time!</p>
        <div class="row g-4 mb-3">
            <div class="col-md-4">
                <div class="card shadow-sm h-100">
                    <div class="card-body text-center p-4">
                        <div class="display-4 fw-bold text-success mb-2">{{ stats.total_ride_leaders }}</div>
                        <h5 class="text-muted mb-0">Total ride leaders</h5>
                        <p class="text-muted small mb-0 mt-2">Unique riders who volunteered as ride leaders at confirmed events</p>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card shadow-sm h-100">
                    <div class="card-body text-center p-4">
                        <div class="display-4 fw-bold text-info mb-2">{{ stats.total_ride_leader_slots }}</div>
                        <h5 class="text-muted mb-0">Times led</h5>
                        <p class="text-muted small mb-0 mt-2">Total number of ride leader slots filled across all events</p>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card shadow-sm h-100">
                    <div class="card-body text-center p-4">
                        <div class="display-4 fw-bold text-warning mb-2">{{ stats.dedicated_leaders }}</div>
                        <h5 class="text-muted mb-0">Dedicated leaders</h5>
                        <p class="text-muted small mb-0 mt-2">Riders who led 5 or more rides during the year</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="mb-5">
        <h2 class="h3 fw-bold mb-4 text-center">Monthly trends</h2>
        <p class="lead text-center mb-4">As soon as the weather permitted end of April, the outdoor rides picked up and kept going strong throughout the summer. During the winter months, our indoor Zwift program keeps us all engaged. By the way, we are looking for a new social director to help arrange social events throughout the year. Interested? <a href="mailto:david.pettersson@ottawabicycleclub.ca">Send us an email!</a></p>
        <div class="row g-4 mb-3">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-body p-4">
                        <h3 class="fs-5 fw-medium mb-3">Events by program</h3>
                        <canvas id="monthlyEventsChart"></canvas>
                        <p class="text-muted small mb-0 mt-3">Number of events held each month, grouped by program type</p>
                    </div>
                </div>
            </div>
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-body p-4">
                        <h3 class="fs-5 fw-medium mb-3">Registrations by program</h3>
                        <canvas id="monthlyRegistrationsChart"></canvas>
                        <p class="text-muted small mb-0 mt-3">Number of confirmed registrations each month, grouped by program type</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="mb-5">
        <h2 class="h3 fw-bold mb-4 text-center">Popular routes</h2>
        <p class="lead text-center mb-4">Our ride coordinators are doing their very best to offer a diverse and interesting program for all members throughout the season. Thank you!</p>
        <div class="row g-4 mb-3">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-body p-4">
                        <h3 class="fs-5 fw-medium mb-3">Most popular routes</h3>
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th scope="col" class="d-none d-sm-table-cell">#</th>
                                        <th scope="col">Route Name</th>
                                        <th scope="col" class="text-end">Registrations</th>
                                    </tr>
                                </thead>
                                <tbody id="routesTableBody">
                                </tbody>
                            </table>
                        </div>
                        <p class="text-muted small mb-0 mt-3">Popularity ranking based on number of confirmed registrations per route</p>
                    </div>
                </div>
            </div>
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-body p-4">
                        <h3 class="fs-5 fw-medium mb-3">Starting points</h3>
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th scope="col" class="d-none d-sm-table-cell">#</th>
                                        <th scope="col">Starting Point</th>
                                        <th scope="col" class="text-end">Registrations</th>
                                    </tr>
                                </thead>
                                <tbody id="locationsTableBody">
                                </tbody>
                            </table>
                        </div>
                        <p class="text-muted small mb-0 mt-3">Number of confirmed registrations grouped by event location</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="mb-5">
        <h2 class="h3 fw-bold mb-4 text-center">See you in 2026!</h2>
        <p class="lead text-center mb-4">
            We are incredibly grateful for everyone's participation throughout 2025! This amazing community of riders, volunteers, and enthusiasts is what makes our club so special. Your passion for cycling and commitment to our programs has created unforgettable experiences and lasting friendships.
        </p>
        <p class="lead text-center mb-4">
            <strong>We're always looking for volunteers!</strong> Whether you want to lead rides, help with events, coordinate programs, or contribute in other ways, we'd love to have you on board. Every contribution makes a difference! Interested? <a href="mailto:david.pettersson@ottawabicycleclub.ca">Send us an email!</a>
        </p>
        <p class="lead text-center mb-4">
            We can't wait to see you on the roads, trails, and at our events. Let's make it the best season yet! ðŸš´âœ¨
        </p>
    </section>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
    const monthlyLabels = {{ monthly_labels|safe }};
    const programs = {{ programs|safe }};
    const eventsByProgramMonthly = {{ events_by_program_monthly|safe }};
    const registrationsByProgramMonthly = {{ registrations_by_program_monthly|safe }};
    const topRoutesLabels = {{ top_routes_labels|safe }};
    const topRoutesCounts = {{ top_routes_counts|safe }};
    const topRoutesDetails = {{ top_routes_details|safe }};
    const programsLabels = {{ programs_labels|safe }};
    const programsCounts = {{ programs_counts|safe }};
    const locationsData = {{ locations_data|safe }};

    Chart.defaults.font.family = "'Inter', sans-serif";
    Chart.defaults.font.weight = 600;

    const programColors = [
        { bg: 'rgba(13, 110, 253, 0.7)', border: 'rgba(13, 110, 253, 1)' },
        { bg: 'rgba(13, 150, 253, 0.7)', border: 'rgba(13, 150, 253, 1)' },
        { bg: 'rgba(13, 180, 250, 0.7)', border: 'rgba(13, 180, 250, 1)' },
        { bg: 'rgba(13, 202, 240, 0.7)', border: 'rgba(13, 202, 240, 1)' },
        { bg: 'rgba(32, 201, 200, 0.7)', border: 'rgba(32, 201, 200, 1)' },
        { bg: 'rgba(32, 201, 151, 0.7)', border: 'rgba(32, 201, 151, 1)' },
        { bg: 'rgba(80, 200, 120, 0.7)', border: 'rgba(80, 200, 120, 1)' },
        { bg: 'rgba(120, 195, 90, 0.7)', border: 'rgba(120, 195, 90, 1)' },
        { bg: 'rgba(160, 190, 70, 0.7)', border: 'rgba(160, 190, 70, 1)' },
        { bg: 'rgba(190, 180, 50, 0.7)', border: 'rgba(190, 180, 50, 1)' },
        { bg: 'rgba(220, 170, 40, 0.7)', border: 'rgba(220, 170, 40, 1)' },
        { bg: 'rgba(240, 150, 30, 0.7)', border: 'rgba(240, 150, 30, 1)' },
        { bg: 'rgba(250, 130, 25, 0.7)', border: 'rgba(250, 130, 25, 1)' },
        { bg: 'rgba(255, 110, 20, 0.7)', border: 'rgba(255, 110, 20, 1)' },
        { bg: 'rgba(255, 90, 20, 0.7)', border: 'rgba(255, 90, 20, 1)' },
        { bg: 'rgba(250, 70, 30, 0.7)', border: 'rgba(250, 70, 30, 1)' },
        { bg: 'rgba(240, 60, 40, 0.7)', border: 'rgba(240, 60, 40, 1)' },
        { bg: 'rgba(230, 50, 50, 0.7)', border: 'rgba(230, 50, 50, 1)' },
        { bg: 'rgba(220, 45, 60, 0.7)', border: 'rgba(220, 45, 60, 1)' },
        { bg: 'rgba(210, 40, 70, 0.7)', border: 'rgba(210, 40, 70, 1)' }
    ];

    const filterMonthsWithData = (labels, dataByProgram) => {
        const filteredIndices = [];
        labels.forEach((label, index) => {
            const hasData = Object.values(dataByProgram).some(programData => programData[index] > 0);
            if (hasData) {
                filteredIndices.push(index);
            }
        });

        return {
            labels: filteredIndices.map(i => labels[i]),
            dataByProgram: Object.fromEntries(
                Object.entries(dataByProgram).map(([program, data]) => [
                    program,
                    filteredIndices.map(i => data[i])
                ])
            )
        };
    };

    const filteredEvents = filterMonthsWithData(monthlyLabels, eventsByProgramMonthly);
    const filteredRegistrations = filterMonthsWithData(monthlyLabels, registrationsByProgramMonthly);

    const monthlyEventsDatasets = programs.map((program, index) => ({
        label: program,
        data: filteredEvents.dataByProgram[program],
        backgroundColor: programColors[index % programColors.length].bg,
        borderColor: programColors[index % programColors.length].border,
        borderWidth: 2
    }));

    const monthlyEventsCtx = document.getElementById('monthlyEventsChart');
    new Chart(monthlyEventsCtx, {
        type: 'bar',
        data: {
            labels: filteredEvents.labels,
            datasets: monthlyEventsDatasets
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            interaction: {
                mode: 'index',
                intersect: false,
            },
            plugins: {
                legend: {
                    display: false,
                },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    padding: 12,
                    cornerRadius: 8,
                    titleFont: {
                        size: 14,
                        weight: 'bold'
                    },
                    bodyFont: {
                        size: 13
                    }
                }
            },
            scales: {
                x: {
                    stacked: true,
                },
                y: {
                    stacked: true,
                    beginAtZero: true,
                    ticks: {
                        stepSize: 1
                    }
                }
            },
            animation: {
                duration: 1500,
                easing: 'easeInOutQuart'
            }
        }
    });

    const monthlyRegistrationsDatasets = programs.map((program, index) => ({
        label: program,
        data: filteredRegistrations.dataByProgram[program],
        backgroundColor: programColors[index % programColors.length].bg,
        borderColor: programColors[index % programColors.length].border,
        borderWidth: 2
    }));

    const monthlyRegistrationsCtx = document.getElementById('monthlyRegistrationsChart');
    new Chart(monthlyRegistrationsCtx, {
        type: 'bar',
        data: {
            labels: filteredRegistrations.labels,
            datasets: monthlyRegistrationsDatasets
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            interaction: {
                mode: 'index',
                intersect: false,
            },
            plugins: {
                legend: {
                    display: false,
                },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    padding: 12,
                    cornerRadius: 8,
                    titleFont: {
                        size: 14,
                        weight: 'bold'
                    },
                    bodyFont: {
                        size: 13
                    }
                }
            },
            scales: {
                x: {
                    stacked: true,
                },
                y: {
                    stacked: true,
                    beginAtZero: true,
                    ticks: {
                        stepSize: 1
                    }
                }
            },
            animation: {
                duration: 1500,
                easing: 'easeInOutQuart'
            }
        }
    });

    const routesTableBody = document.getElementById('routesTableBody');
    topRoutesDetails.forEach((route, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <th scope="row" class="d-none d-sm-table-cell">${index + 1}</th>
            <td>${route.name}</td>
            <td class="text-end"><strong>${route.registrations}</strong></td>
        `;
        routesTableBody.appendChild(row);
    });

    const locationsTableBody = document.getElementById('locationsTableBody');
    locationsData.slice(0, 5).forEach((location, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <th scope="row" class="d-none d-sm-table-cell">${index + 1}</th>
            <td>${location.location}</td>
            <td class="text-end"><strong>${location.registrations}</strong></td>
        `;
        locationsTableBody.appendChild(row);
    });
</script>
{% endblock %}
